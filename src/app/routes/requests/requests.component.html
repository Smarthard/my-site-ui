<div *ngFor="let request of (requests$ | async)">
    <mat-card>
        <mat-card-header>
            <mat-card-title>
                <mat-icon *ngIf="!request?.reviewed"
                          class="unreviewed">
                    priority_high
                </mat-icon>
                <mat-icon *ngIf="isRejected(request)"
                          class="rejected">
                    clear
                </mat-icon>
                <mat-icon *ngIf="isApproved(request)"
                          class="approved">
                    done
                </mat-icon>

                <span>{{ getRequestType(request) | titlecase }} request
                    <a [href]="'https://smarthard.net/api/requests/' + request?.id">#{{ request?.id }}</a>
                    by
                    <a [href]="request?.requester">{{ getNickname(request?.requester) }}</a>
                </span>
                <span class="fill-remaining-space"></span>
            </mat-card-title>
            <mat-card-subtitle>
                <div>
                    Target ID: {{ request?.targetId }}
                </div>

                <div [title]="request?.createdAt">
                    Created at {{ request?.createdAt | date:'dd.MM.y HH:mm' }}
                </div>

                <div *ngIf="request?.reviewed"
                     [title]="request?.reviewed">
                    Reviewed at {{ request?.reviewed | date:'dd.MM.y HH:mm' }}
                </div>

                <div *ngIf="!request?.reviewed">
                    Not reviewed yet
                </div>
            </mat-card-subtitle>
        </mat-card-header>
        <mat-card-content>

            <div class="comment-section">
                <b>Comment:</b>
                <p><span>{{ request?.comment }}</span></p>
            </div>

            <div class="new-data">
                <b>New:</b>

                <ng-container *ngIf="!isEmpty(request); else emptyRequestLable">
                    <ngx-json-view [data]="request?.request" levelOpen="1"></ngx-json-view>
                </ng-container>

                <ng-template #emptyRequestLable>
                    <div style="margin-left: 14px">None</div>
                </ng-template>
            </div>

            <div class="old-data">
                <b>Old:</b>
                <ngx-json-view [data]="request?.old" levelOpen="1"></ngx-json-view>
            </div>

            <div *ngIf="hasFeedback(request)"
                 class="feedback">
                <b>Feedback:</b>
                <p>{{ request?.feedback }}</p>
            </div>
        </mat-card-content>

        <mat-card-footer>
            <button class="approved"
                    [disabled]="isReviewed(request)"
                    (click)="approve(request)"
                    mat-button>
                <mat-icon>done</mat-icon>
            </button>

            <button class="rejected"
                    (click)="reject(request)"
                    [disabled]="isReviewed(request)"
                    mat-button>
                <mat-icon>clear</mat-icon>
            </button>

            <button class="unreviewed"
                    (click)="revert(request)"
                    [disabled]="!isReviewed(request)"
                    mat-button>
                <mat-icon>restore</mat-icon>
            </button>
        </mat-card-footer>
    </mat-card>
</div>
